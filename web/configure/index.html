<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stremio Shared Debrid</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="number"], input[type="password"], textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button, .install-btn {
            background-color: #007bff;
            color: white;
            padding: 6px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            text-decoration: none;
            display: block;
            width: 100px;
            margin: 20px auto 0;
            text-align: center;
        }
        button:hover, .install-btn:hover {
            background-color: #0056b3;
            text-decoration: none;
        }
        .hint {
            font-size: 0.75em;
            margin-top: 5px;
        }
        .highlight {
            display: inline-block;
            background-color: #fff3cd;
        }
        .note {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 4px;
            margin-top: 20px;
        }
        .github-link {
            text-align: center;
            margin-top: 30px;
            color: #333;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: color 0.3s ease;
        }
        .github-link:hover {
            color: #007bff;
            text-decoration: none;
        }
        .github-icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Stremio Shared Debrid</h1>
        <p>Configure your Stremio Shared Debrid addon settings.</p>

        <form id="configureForm">
            <div class="form-group">
                <label for="authToken">GitHub API Token:</label>
                <input type="password" id="authToken" name="authToken" placeholder="Enter GitHub API Token">
                <p class="hint">The API token should have permissions to access and modify gists.</p>
            </div>

            <div class="form-group">
                <label for="gistId">Gist ID:</label>
                <input type="text" id="gistId" name="gistId" placeholder="Enter Gist ID">
                <p class="hint">Ex: https://gist.github.com/abcxyz/<span class="highlight">123456abcdef123456abcdef</span></p>
            </div>

            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" placeholder="Enter username, name, location or anything to identify you">
                <p class="hint">Each Stremio account should have different username.</p>
            </div>

            <div class="form-group">
                <label for="sessionMinutes">Estimated watching time (minutes)</label>
                <input type="number" id="sessionMinutes" name="sessionMinutes" placeholder="Enter session minutes" value="180" min="1">
                <p class="hint">Not sure? The default <span class="highlight">180</span> minutes works for most users.</p>
            </div>

            <a href="#" class="install-btn" id="installBtn">Install</a>
        </form>

        <div class="note">
          <strong>Note:</strong>
          Each user must use their <em>own</em> Stremio account, even if they are all sharing the same debrid account.
          This addon will NOT work if everyone is logged into a single shared Stremio account.
        </div>

        <a href="https://github.com/anhkind/stremio-shared-debrid" class="github-link" target="_blank" rel="noopener noreferrer">
            <svg class="github-icon" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.59-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
            </svg>
            View on GitHub
        </a>
    </div>

    <script>
        // Function to build the manifest URL
        function buildInstallUrl(authToken, gistId, username, sessionMinutes) {
            let baseUrl = `${window.location.origin}/${authToken}/${gistId}/${username}`;

            // Add sessionMinutes to URL if it's provided and not 0
            if (sessionMinutes && sessionMinutes !== '0') {
                baseUrl += `/${sessionMinutes}`;
            }

            const manifestUrl = encodeURI(`${baseUrl}/manifest.json`);
            return manifestUrl.replace(/https?/, 'stremio');
        }

        // Function to update install button href
        function updateInstallUrl() {
            const authToken      = document.getElementById('authToken'     ).value?.trim();
            const gistId         = document.getElementById('gistId'        ).value?.trim();
            const username       = document.getElementById('username'      ).value?.trim();
            const sessionMinutes = document.getElementById('sessionMinutes').value?.trim();

            // Only update if required fields are filled
            if (authToken && gistId && username) {
                document.getElementById('installBtn').href = buildInstallUrl(authToken, gistId, username, sessionMinutes);
            } else {
                document.getElementById('installBtn').href = '#';
            }
        }

        // Add event listeners to all input fields
        document.getElementById('authToken'     ).addEventListener('input', updateInstallUrl);
        document.getElementById('gistId'        ).addEventListener('input', updateInstallUrl);
        document.getElementById('username'      ).addEventListener('input', updateInstallUrl);
        document.getElementById('sessionMinutes').addEventListener('input', updateInstallUrl);
    </script>
</body>
</html>
